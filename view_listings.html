<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>View Listings</title>
</head>
<body>
    
    <div id="listingContainer">
        <h1>All Listings</h1>
        <button onclick="editAllListings()" class="bt1">Edit All Listings</button>
        <div id="listings"></div>
        <div id="totalPrice"></div> <!-- Added total price section -->

        <a href="index.html">
            <button onclick="location.href='add_listing.html'" class="bt1">Add Another Listing</button>
        </a>
    </div>
    <script src="view_script.js"></script>
    
</body>
<style>
body {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    height: 100vh;
    background: #e9f7fe;
    font-family: Arial, sans-serif;
}

#listingContainer {
    text-align: center;
    width: 80%;
    padding: 20px;
    background: #ffffff;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

h1 {
    margin-bottom: 20px;
    color: #333;
}

.listing {
    background: #d7d5d5;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s;
}

.listing:hover {
    transform: scale(1.02);
    background: #8db7e4;
}

.bt1 {
    background-color: #007BFF;
    color: white;
    border: none;
    padding: 12px;
    margin-top: 10px;
    cursor: pointer;
    width: 100%;
    border-radius: 5px;
    font-size: 16px;
}

.bt1:hover {
    background-color: #0056b3;
}

.edit-button, .delete-button {
    margin-top: 10px;
    margin-right: 5px;
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.edit-button {
    background-color: #ffc107;
    color: white;
}

.delete-button {
    background-color: #dc3545;
    color: white;
}

.edit-button:hover {
    background-color: #e0a800;
}

.delete-button:hover {
    background-color: #c82333;
}

img {
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 5px;
    width: 150px;
}

#totalPrice {
    margin-top: 20px;
    font-size: 20px;
    font-weight: bold;
    color: #333;
}
</style>
<script>
window.onload = function() {
    const listings = JSON.parse(localStorage.getItem('listings')) || [];
    const listingsContainer = document.getElementById('listings');
    const totalPriceContainer = document.getElementById('totalPrice');
    let totalSum = 0;

    if (listings.length === 0) {
        listingsContainer.innerHTML = '<p>No listings available.</p>';
    } else {
        listings.forEach((listing, index) => {
            const listingDiv = document.createElement('div');
            listingDiv.className = 'listing';
            listingDiv.innerHTML = `
                <img src="${listing.file}" alt="Listing Image" style="width:150px">
                <h3>${listing.title}</h3>
                <p>${listing.description}</p>
                <p><strong>Price: $${listing.price}</strong></p>
                <button class="edit-button" onclick="editListing(${index})">Edit</button>
                <button class="delete-button" onclick="deleteListing(${index})">Delete</button>
            `;
            listingsContainer.appendChild(listingDiv);

            // Sum up the prices
            totalSum += parseFloat(listing.price);
        });

        // Display total price
        totalPriceContainer.innerHTML = `Total Price: $${totalSum.toFixed(2)}`;
    }
};

function editListing(index) {
    const listings = JSON.parse(localStorage.getItem('listings'));
    const listing = listings[index];

    const file = prompt("Edit Img:", listing.file);
    const title = prompt("Edit Title:", listing.title);
    const description = prompt("Edit Description:", listing.description);
    const price = prompt("Edit Price:", listing.price);

    if (file !== null && title !== null && description !== null && price !== null) {
        listings[index] = { file, title, description, price };
        localStorage.setItem('listings', JSON.stringify(listings));
        location.reload(); // Refresh to show updated listings
    }
}

function deleteListing(index) {
    const listings = JSON.parse(localStorage.getItem('listings'));
    listings.splice(index, 1); // Remove listing at index
    localStorage.setItem('listings', JSON.stringify(listings));
    location.reload(); // Refresh to show updated listings
}

function editAllListings() {
    const listings = JSON.parse(localStorage.getItem('listings'));
    
    listings.forEach((listing, index) => {

        const file = prompt(`Edit Img for ${listing.file}:`, listing.file);
        const title = prompt(`Edit Title for ${listing.title}:`, listing.title);
        const description = prompt(`Edit Description for ${listing.title}:`, listing.description);
        const price = prompt(`Edit Price for ${listing.title}:`, listing.price);

        if (file !== null && title !== null && description !== null && price !== null) {
            listings[index] = { file, title, description, price };
        }
    });

    localStorage.setItem('listings', JSON.stringify(listings));
    location.reload(); // Refresh to show updated listings
}
</script>
</html>
